<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>손님 시스템 프로토타입</title>
<style>
:root{
  --bg:#0f1115; --panel:#171a21; --line:#2b3242; --text:#e6e9ef;
  --muted:#9aa3b2; --accent:#7cd1ff; --green:#2ecc71; --orange:#ff9f43;
}
*{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);display:flex;flex-direction:column;align-items:center;gap:12px}
.topbar{position:sticky;top:0;width:100%;max-width:420px;background:var(--panel);border:1px solid var(--line);border-radius:12px;margin:12px;padding:10px 12px;display:flex;justify-content:space-between;align-items:center}
.menu{display:flex;gap:8px;align-items:center;font-size:14px}
.badge{border:1px solid var(--line);padding:6px 10px;border-radius:999px;background:#141923}
.clock{font-variant-numeric:tabular-nums;color:var(--muted)}
.stage{width:100%;max-width:420px;aspect-ratio:3/5;background:#0b0e13;border:1px solid var(--line);border-radius:16px;position:relative;overflow:hidden}
.map-rect{position:absolute;inset:12px;background:#10151f;border:1px solid var(--line);border-radius:12px}
.counter{position:absolute;left:50%;top:42%;transform:translate(-50%,-50%);width:70%;height:70px;background:#18202d;border:2px solid #2a3850;border-radius:10px;display:flex;align-items:center;justify-content:center}
.counter::after{content:"카운터";position:absolute;bottom:-20px;color:var(--muted);font-size:12px}
.entrance{position:absolute;left:50%;bottom:6px;transform:translateX(-50%);width:90px;height:10px;background:#2a2f3d;border-radius:8px}
.entrance::after{content:"입구";position:absolute;top:-18px;left:50%;transform:translateX(-50%);color:var(--muted);font-size:12px}
.player{position:absolute;width:22px;height:22px;background:var(--green);border-radius:50%;box-shadow:0 0 10px #2ecc7188}
.player.on-counter{left:50%;top:42%;transform:translate(-50%,-50%)}
.customer{position:absolute;width:20px;height:20px;background:var(--orange);border-radius:50%;box-shadow:0 0 12px #ff9f4388;transition:top 2s linear,left 2s linear}
.overlay{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:20}
.modal{min-width:280px;max-width:90vw;background:#141923;border:1px solid var(--line);border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:12px}
.modal h2{margin:0;font-size:18px}
.modal p{margin:0;color:var(--muted);font-size:14px}
.row{display:flex;gap:8px;flex-wrap:wrap}
.btn{cursor:pointer;border:1px solid var(--line);background:#0f1320;color:var(--text);padding:10px 12px;border-radius:10px}
.btn.primary{background:#11223a}
.hide{display:none}
</style>
</head>
<body>
  <!-- 상단 인터페이스 -->
  <div class="topbar" id="ui">
    <div class="menu">
      <span class="badge">불고기 버거</span>
      <span class="badge">치킨 버거</span>
    </div>
    <div class="clock" id="clock">00:00:00</div>
  </div>

  <!-- 맵 -->
  <div class="stage" id="stage">
    <div class="map-rect"></div>
    <div class="counter" id="counter"></div>
    <div class="entrance" id="entrance"></div>
    <div class="player on-counter" title="플레이어"></div>
  </div>

  <!-- 시작 오버레이 -->
  <div class="overlay" id="startOverlay">
    <div class="modal">
      <h2>게임 시작</h2>
      <p>시작을 누르면 손님이 입장한다.</p>
      <button class="btn primary" id="startBtn">게임 시작</button>
    </div>
  </div>

  <!-- 주문 팝업 -->
  <div class="overlay hide" id="orderOverlay">
    <div class="modal" id="orderModal">
      <h2>주문</h2>
      <p id="orderText">손님이 주문을 선택했다.</p>
      <div class="row">
        <!-- 단일 항목만 표시 규칙에 맞춤 -->
        <button class="btn primary" id="orderConfirm">선택</button>
      </div>
    </div>
  </div>

<script>
const clockEl = document.getElementById('clock');
setInterval(()=>{
  const d=new Date();
  const pad=n=>String(n).padStart(2,'0');
  clockEl.textContent = `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
},1000);

// 좌표 계산
const stage = document.getElementById('stage');
const counter = document.getElementById('counter');
const entrance = document.getElementById('entrance');

function getCenter(el){
  const r = el.getBoundingClientRect();
  const s = stage.getBoundingClientRect();
  return { x: r.left - s.left + r.width/2, y: r.top - s.top + r.height/2 };
}

// 게임 흐름
const startBtn = document.getElementById('startBtn');
const startOverlay = document.getElementById('startOverlay');
const orderOverlay = document.getElementById('orderOverlay');
const orderText = document.getElementById('orderText');
const orderConfirm = document.getElementById('orderConfirm');

startBtn.addEventListener('click', ()=>{
  startOverlay.classList.add('hide');
  spawnCustomer();
});

function spawnCustomer(){
  const cust = document.createElement('div');
  cust.className = 'customer';
  stage.appendChild(cust);

  // 시작 위치: 입구 중앙
  const ent = getCenter(entrance);
  cust.style.left = (ent.x - 10) + 'px';
  cust.style.top  = (ent.y - 10) + 'px';

  // 다음 프레임에 카운터로 이동
  requestAnimationFrame(()=>{
    const tgt = getCenter(counter);
    // 카운터 앞 포인트 살짝 아래
    const yOffset = counter.offsetHeight/2 + 14;
    cust.style.left = (tgt.x - 10) + 'px';
    cust.style.top  = (tgt.y + yOffset - 10) + 'px';
  });

  cust.addEventListener('transitionend', function arrivedAtCounter(e){
    if(orderOverlay.classList.contains('hide')===false) return;
    // 주문 팝업 표시. 불고기 또는 치킨 중 하나만 출력
    const pick = Math.random() < 0.5 ? '불고기 버거' : '치킨 버거';
    orderText.textContent = `손님이 ${pick}를 주문했다. 클릭하여 전달.`;
    orderConfirm.textContent = pick;
    orderOverlay.classList.remove('hide');

    // 주문 클릭 시 하행 이동
    const confirmOnce = ()=>{
      orderOverlay.classList.add('hide');
      orderConfirm.removeEventListener('click', confirmOnce);

      // 입구로 복귀
      const ent2 = getCenter(entrance);
      // 이동 시작
      requestAnimationFrame(()=>{
        cust.style.left = (ent2.x - 10) + 'px';
        cust.style.top  = (ent2.y - 10) + 'px';
      });

      cust.addEventListener('transitionend', function leaveAndRemove(){
        cust.removeEventListener('transitionend', leaveAndRemove);
        cust.remove(); // 맵에서 사라짐
      }, { once:true });
    };
    orderConfirm.addEventListener('click', confirmOnce, { once:true });
  }, { once:true });
}
</script>
</body>
</html>
